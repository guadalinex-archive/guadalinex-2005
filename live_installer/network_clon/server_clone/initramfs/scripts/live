# Live filesystem mounting			-*- shell-script -*-
# FIXME: finish the function

# Parameter: Where to mount the filesystem
mountroot ()
{
	# FIXME: Move to here the scripts (parted,format,network,etc)
	log_begin_msg "Running /scripts/live-top"
	run_scripts /scripts/live-top
	log_end_msg

	# Get the root filesystem type
	if [ ! -e "${ROOT}" ]; then
		panic "ALERT!  ${ROOT} does not exist.  Dropping to a shell!"
	fi

	# FIXME: Find and mount the Image
	log_begin_msg "Running /scripts/live-premount"
	run_scripts /scripts/live-premount
	log_end_msg

	modprobe unionfs

	# Mount root
	rootmnt=${rootmnt}/root
	changes=${rootmnt}/changes
	image=${rootmnt}/image
	mkdir -p ${rootmnt} ${changes}

	mount -t tmpfs -o "size=80%" tmpfs ${changes}
	mount -t unionfs dirs=${changes}=rw:${image}=ro unionfs ${rootmnt}

	# FIXME: Here is where we make the changes to the system (links, etc)
	log_begin_msg "Running /scripts/log-bottom"
	run_scripts /scripts/live-bottom
	log_end_msg
}
