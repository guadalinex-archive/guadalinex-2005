#! /bin/sh
# preinst script for gen-package
#
# see: dh_installdeb(1)

#set -e

# summary of how this script can be called:
#        * <new-preinst> `install'
#        * <new-preinst> `install' <old-version>
#        * <new-preinst> `upgrade' <old-version>
#        * <old-preinst> `abort-upgrade' <new-version>
#
# For details see /usr/share/doc/packaging-manual/

case "$1" in
    install|upgrade)
#        if [ "$1" = "upgrade" ]
#        then
#            start-stop-daemon --stop --quiet --oknodo  \
#                --pidfile /var/run/03_apt_proxy.pid  \
#                --exec /usr/sbin/03_apt_proxy 2>/dev/null || true
#        fi

	# make a list of files modified by the user, in order to
	# make them remain at the postinst
	SKELDIR="/usr/share/dpsyco/skel"
	TEMPLIST="/tmp/modified_files"
    ORIGINALLIST="/tmp/original_files"

    if [ ! -f $ORIGINALLIST ]
    then
	    cd $SKELDIR;find -type f|sed -e 's/^\.\///' > $ORIGINALLIST
    fi

    list=`cat $ORIGINALLIST`
    IFS=$'\n'
	for file in $list; do
		realfile="/$file"
        if [ -e "$realfile" ] 
        then
		    skelfile="$SKELDIR/$file"
		    diff $skelfile $realfile > /dev/null 2>&1
		    if [ $? -ne 0 ];then
		    	echo $realfile >> $TEMPLIST
		    fi
        fi
	done
    unset IFS
    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 0
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0


